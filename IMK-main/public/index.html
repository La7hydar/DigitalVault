<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigitalVault | Login Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; background: linear-gradient(135deg, #020617 0%, #0f172a 100%); color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input { background: rgba(0,0,0,0.3) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; outline: none; }
        input:focus { border-color: #22d3ee !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

    <div class="w-full max-w-sm glass p-8 rounded-[30px] shadow-2xl relative overflow-hidden">
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-cyan-500/20 rounded-full blur-3xl"></div>
        <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl"></div>

        <div class="text-center mb-8 relative z-10">
            <h1 class="text-3xl font-bold tracking-tighter mb-2">DIGITAL<span class="text-cyan-400">VAULT</span></h1>
            <p class="text-slate-400 text-xs tracking-widest uppercase">Secure Access Gateway</p>
        </div>

        <div class="flex bg-black/20 rounded-xl p-1 mb-6 relative z-10">
            <button onclick="switchTab('login')" id="tabLogin" class="flex-1 py-2 text-xs font-bold rounded-lg bg-cyan-500 text-slate-900 transition shadow-lg">LOGIN</button>
            <button onclick="switchTab('register')" id="tabRegister" class="flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition">DAFTAR</button>
        </div>

        <div id="formLogin" class="space-y-4 relative z-10">
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Username</label>
                <input type="text" id="loginUser" class="w-full p-3 rounded-xl text-sm" placeholder="Masukan username...">
            </div>
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Password</label>
                <input type="password" id="loginPass" class="w-full p-3 rounded-xl text-sm" placeholder="••••••••">
            </div>
            <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-3 rounded-xl hover:opacity-90 transition shadow-lg shadow-cyan-500/20 mt-2">
                MASUK SEKARANG
            </button>
        </div>

        <div id="formRegister" class="space-y-4 hidden relative z-10">
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Buat Username</label>
                <input type="text" id="regUser" class="w-full p-3 rounded-xl text-sm" placeholder="Contoh: user123">
            </div>
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Buat Password</label>
                <input type="password" id="regPass" class="w-full p-3 rounded-xl text-sm" placeholder="••••••••">
            </div>
            <button onclick="handleRegister()" class="w-full border border-cyan-500 text-cyan-400 font-bold py-3 rounded-xl hover:bg-cyan-500 hover:text-slate-900 transition mt-2">
                DAFTAR AKUN BARU
            </button>
        </div>

        <p id="msg" class="text-center text-[10px] mt-6 min-h-[20px] font-bold"></p>
    </div>

    <script>
        // 1. Setting Server (HARUS SAMA dengan shop.html)
        const API_URL = 'http://127.0.0.1:3000/api/auth'; 

        // 2. Fungsi Login
        async function handleLogin() {
            const username = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPass').value;
            const msg = document.getElementById('msg');

            if(!username || !password) return showMsg("Harap isi semua kolom!", "red");

            msg.innerText = "Menghubungi server...";
            msg.className = "text-center text-[10px] mt-6 text-yellow-400 blink";

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();

                if(res.ok) {
                    showMsg("Login Berhasil! Mengalihkan...", "green");
                    
                    // SIMPAN TIKET ASLI DARI SERVER
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user)); // Opsional
                    
                    setTimeout(() => { window.location.href = 'shop.html'; }, 1000);
                } else {
                    showMsg(data.message || "Login Gagal", "red");
                }
            } catch (err) {
                console.error(err);
                showMsg("Gagal koneksi ke server (Pastikan node server.js jalan)", "red");
            }
        }

        // 3. Fungsi Register
        async function handleRegister() {
            const username = document.getElementById('regUser').value;
            const password = document.getElementById('regPass').value;

            if(!username || !password) return showMsg("Isi username & password!", "red");

            try {
                const res = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();

                if(res.ok) {
                    showMsg("Registrasi Berhasil! Silakan Login.", "green");
                    setTimeout(() => switchTab('login'), 1500);
                } else {
                    showMsg(data.message || "Gagal Daftar", "red");
                }
            } catch (err) {
                showMsg("Server Error", "red");
            }
        }

        // Helper: Ganti Tab
        function switchTab(tab) {
            document.getElementById('formLogin').classList.toggle('hidden', tab !== 'login');
            document.getElementById('formRegister').classList.toggle('hidden', tab !== 'register');
            
            // Update tombol active
            const btnLogin = document.getElementById('tabLogin');
            const btnReg = document.getElementById('tabRegister');
            
            if(tab === 'login') {
                btnLogin.className = "flex-1 py-2 text-xs font-bold rounded-lg bg-cyan-500 text-slate-900 transition shadow-lg";
                btnReg.className = "flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition";
            } else {
                btnLogin.className = "flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition";
                btnReg.className = "flex-1 py-2 text-xs font-bold rounded-lg bg-cyan-500 text-slate-900 transition shadow-lg";
            }
            document.getElementById('msg').innerText = "";
        }

        function showMsg(text, color) {
            const el = document.getElementById('msg');
            el.innerText = text;
            el.className = `text-center text-[10px] mt-6 font-bold text-${color}-400`;
        }

        // Cek jika sudah login, langsung lempar ke shop
        // (Tapi kita validasi token dulu biar gak loop)
        /* Kita matikan fitur auto-redirect ini dulu agar Anda bisa
           Login ulang dengan benar dan mendapatkan token baru.
        */
        // if(localStorage.getItem('token')) window.location.href = 'shop.html'; 

    </script>
</body>
</html>